<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Employees</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="sidebar.css">
</head>
<body>

    <!-- Sidebar -->
    <nav class="sidebar">
        <ul class="nav flex-column">
            <li class="nav-item"><a class="nav-link" href="dashboard.html">Users</a></li>
            <li class="nav-item"><a class="nav-link" href="employees.html">Employees</a></li>
            <li class="nav-item"><a class="nav-link" href="students.html">Students</a></li>
            <li class="nav-item"><a class="nav-link text-danger" href="index.php" id="logoutBtn">Logout</a></li>
        </ul>
    </nav>

    <!-- Main Content -->
    <main>
        <h2 class="fw-bold text-primary">Employees</h2>
        <div class="table-responsive">
            <table class="table table-hover" id="employeeTable">
                <thead class="table-primary">
                    <tr>
                        <th>ID</th>
                        <th>Name</th>
                        <th>Email</th>
                        <th>Position</th>
                        <th>Salary</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
    </main>

    <script>

        document.addEventListener("DOMContentLoaded", function () {
            const currentPage = window.location.pathname.split("/").pop(); 
            const navLinks = document.querySelectorAll(".nav-link");

            navLinks.forEach(link => {
                if (link.getAttribute("href") === currentPage) {
                    link.style.fontWeight = "bold"; 
                }
            });

            // Fetch Employee Data
            const token = localStorage.getItem("token");
            const tableBody = document.querySelector("#employeeTable tbody");

            if (!token) {
                alert("Unauthorized access. Please log in.");
                window.location.href = "index.php";
                return;
            }

            fetch("http://127.0.0.1:8000/api/employee", {
                method: "GET",
                headers: {
                    "Content-Type": "application/json",
                    "Authorization": "Bearer " + token
                }
            })
            .then(response => response.json())
            .then(data => {
                tableBody.innerHTML = "";
                data.forEach((employee, index) => {
                    tableBody.insertAdjacentHTML("beforeend", `
                        <tr>
                            <td>${index + 1}</td>
                            <td>${employee.name}</td>
                            <td>${employee.email}</td>
                            <td>${employee.position}</td>
                            <td>${employee.salary}</td>
                        </tr>
                    `);
                });
            })
            .catch(error => {
                alert("Failed to load employee data. Please try again.");
            });

            // Logout Function
            document.getElementById("logoutBtn").addEventListener("click", function () {
                localStorage.removeItem("token");
                window.location.href = "index.php";
            });
        });
    </script>

</body>
</html>
